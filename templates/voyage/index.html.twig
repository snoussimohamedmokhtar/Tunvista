{% extends 'back.html.twig' %}

{% block title %}Voyage index{% endblock %}

{% block body %}
    <h1>Voyage index</h1>
    <div style="display:flex;justify-content:space-between;flex-wrap:wrap;align-items:center">

    </div>


    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search...">

    <table class="table table-striped table-bordered" id="VoyageTable">
        <thead>
            <tr>
                <th>Id</th>
                <th>Programme</th>
                <th>DateDepart</th>
                <th>DateArrive</th>
                <th>Distination</th>
                <th>Image</th>
                <th>Prix</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        {% for voyage in voyages %}
            <tr>
                <td>{{ voyage.id }}</td>
                <td>{{ voyage.Programme }}</td>
                <td>{{ voyage.DateDepart ? voyage.DateDepart|date('Y-m-d') : '' }}</td>
                <td>{{ voyage.DateArrive ? voyage.DateArrive|date('Y-m-d') : '' }}</td>
                <td>{{ voyage.Destination }}</td>
                <td>                        <img src="{{ asset('/uploads/' ~ voyage.image) }}"  style="max-width: 100px; max-height: 100px;">
                </td>
                <td>{{ voyage.Prix }} </td>
                <td>
                    <a href="{{ path('app_voyage_show', {'id': voyage.id}) }}" class="btn btn-primary" style="border-radius: 10px;">show</a>
                    <a href="{{ path('app_voyage_edit', {'id': voyage.id}) }}" class="btn btn-warning" style="border-radius: 10px;">edit</a>
                    <a href="{{ path('app_voyage_edit', {'id': voyage.id}) }}" class="btn btn-danger" style="border-radius: 10px;">Delete</a>
                    <a href="{{ path('voyage_generate_pdf', { 'id': voyage.id }) }}" class="btn btn-primary">Download PDF</a>

                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>


    <div class="text-center">
        <a href="{{ path('app_voyage_new') }}" class="btn btn-success" style="border-radius: 10px;"><span class="bi bi-cart-plus"></span> Create new</a>

    </div>
    {# Manual pagination controls #}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if currentPage > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('app_voyage_index', {'page': currentPage - 1}) }}">Previous</a>
                </li>
            {% endif %}

            {% for page in 1..totalPages %}
                <li class="page-item{% if page == currentPage %} active{% endif %}">
                    <a class="page-link" href="{{ path('app_voyage_index', {'page': page}) }}">{{ page }}</a>
                </li>
            {% endfor %}

            {% if currentPage < totalPages %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('app_voyage_index', {'page': currentPage + 1}) }}">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>

<script>
    // Function to send AJAX request for search
    function search() {
        var query = document.getElementById('searchInput').value;
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '{{ path('app_voyage_search') }}?q=' + query, true);
        xhr.onload = function () {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                updateTable(response);
            }
        };
        xhr.send();
    }

    // Function to update the table with search results
    function updateTable(data) {
        var tableBody = document.querySelector('tbody');
        tableBody.innerHTML = ''; // Clear existing table rows
        if (data.length > 0) {
            data.forEach(function (voyage) {
                var row = '<tr>';
                row += '<td>' + voyage.Programme + '</td>';
                row += '<td>' + voyage.Prix + '</td>';
                row += '<td>' + voyage.DateDepart + '</td>';
                row += '<td>' + voyage.DateArrive + '</td>';

                row += '</tr>';
                tableBody.innerHTML += row;
            });
        } else {
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No records found</td></tr>';
        }
    }

    // Event listener for the search input
    document.getElementById('searchInput').addEventListener('input', function () {
        search();
    });
</script>
{% endblock %}


